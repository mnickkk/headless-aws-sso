#!/usr/bin/env node
const { execFileSync } = require("child_process");
const path = require("path");

const PLATFORMS = {
  "darwin-arm64": "@headless-aws-sso/darwin-arm64",
  "linux-x64": "@headless-aws-sso/linux-x64",
  "linux-arm64": "@headless-aws-sso/linux-arm64",
};

const key = `${process.platform}-${process.arch}`;
const pkg = PLATFORMS[key];
if (!pkg) {
  console.error(`Unsupported platform: ${key}`);
  process.exit(1);
}

try {
  const binPath = path.join(
    require.resolve(`${pkg}/package.json`),
    "..",
    "headless-aws-sso"
  );
  execFileSync(binPath, process.argv.slice(2), { stdio: "inherit" });
} catch (e) {
  if (e && e.status != null) {
    // Binary ran but exited with non-zero â€” forward the exit code
    process.exit(e.status);
  }
  console.error(
    `Failed to run headless-aws-sso for ${key}. Is the package installed?`
  );
  console.error(`Try: npm install ${pkg}`);
  process.exit(1);
}
